<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>System Settings & Maintenance | Starbucks Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        :root { --sb-forest: #1e3932; --sb-green: #007042; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.5s; background-color: #f0f2f5; }
        .dark body { background-color: #0b1613; color: #d4e9e2; }
        
        /* Sidebar Standard - Đồng bộ icon và hiệu ứng */
        .sidebar-floating { background: var(--sb-forest); width: 70px; height: calc(100vh - 40px); position: fixed; top: 20px; left: 20px; border-radius: 35px; z-index: 100; display: flex; flex-direction: column; align-items: center; padding: 1.5rem 0; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .nav-icon { width: 46px; height: 46px; display: flex; align-items: center; justify-content: center; border-radius: 16px; cursor: pointer; color: rgba(255, 255, 255, 0.3); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); margin-bottom: 0.8rem; position: relative; }
        .nav-icon:hover, .active-page { background: rgba(255, 255, 255, 0.15); color: #fff; transform: scale(1.15); }
        
        /* Tooltip Logic - ẨN CHỮ XẤU */
        .tooltip { position: absolute; left: 65px; background: var(--sb-forest); color: white; padding: 6px 12px; border-radius: 10px; font-size: 9px; font-weight: 800; text-transform: uppercase; white-space: nowrap; transform: scale(0); transition: 0.2s; z-index: 1000; pointer-events: none; border: 1px solid rgba(255,255,255,0.1); }
        .nav-icon:hover .tooltip { transform: scale(1); }
        
        .logout-btn:hover { background: #ef4444 !important; color: white !important; box-shadow: 0 10px 20px rgba(239, 68, 68, 0.4); }

        .bento-card { border-radius: 30px; background: white; border: 1px solid rgba(0,0,0,0.03); padding: 2rem; }
        .dark .bento-card { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.05); }
        
        .status-tag { padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .log-entry { font-family: 'Courier New', monospace; font-size: 12px; border-bottom: 1px solid rgba(0,0,0,0.05); padding: 10px 0; }
    </style>
</head>
<body class="flex p-5">

    <aside class="sidebar-floating shadow-2xl">
        <div class="mb-8"><img src="https://upload.wikimedia.org/wikipedia/en/d/d3/Starbucks_Corporation_Logo_2011.svg" class="w-10 bg-white p-1 rounded-full"></div>
        <nav class="flex-1">
            <div onclick="location.href='admin-dashboard.html'" class="nav-icon" id="nav-dash">
                <i class="fa-solid fa-chart-pie"></i>
                <span class="tooltip">Báo cáo</span>
            </div>
            <div onclick="location.href='admin-tables.html'" class="nav-icon" id="nav-tables">
                <i class="fa-solid fa-layer-group"></i>
                <span class="tooltip">Sơ đồ bàn</span>
            </div>
            <div onclick="location.href='admin-menu.html'" class="nav-icon" id="nav-menu">
                <i class="fa-solid fa-mug-hot"></i>
                <span class="tooltip">Thực đơn</span>
            </div>
            <div onclick="location.href='inventory.html'" class="nav-icon" id="nav-inv">
                <i class="fa-solid fa-boxes-stacked"></i>
                <span class="tooltip">Kho hàng</span>
            </div>
            <div onclick="location.href='hr.html'" class="nav-icon" id="nav-hr">
                <i class="fa-solid fa-user-shield"></i>
                <span class="tooltip">Nhân sự</span>
            </div>
            <div onclick="location.href='admin-settings.html'" class="nav-icon active-page" id="nav-set">
                <i class="fa-solid fa-gears"></i>
                <span class="tooltip">Cài đặt</span>
            </div>
        </nav>
        <button onclick="handleLogout()" class="nav-icon logout-btn mt-auto">
            <i class="fa-solid fa-power-off"></i>
            <span class="tooltip">Đăng xuất</span>
        </button>
    </aside>

    <main class="ml-24 w-full grid grid-cols-12 gap-6">
        <header class="col-span-12 flex justify-between items-center mb-4">
            <div>
                <h1 class="text-3xl font-black italic uppercase tracking-tighter text-[#1e3932] dark:text-white">System Configuration</h1>
                <p class="text-xs font-bold text-green-600 uppercase tracking-widest">Package 10: Adaptive & Corrective Maintenance</p>
            </div>
            <button onclick="toggleTheme()" class="w-12 h-12 bento-card flex items-center justify-center"><i id="t-icon" class="fa-solid fa-moon"></i></button>
        </header>

        <div class="col-span-12 lg:col-span-4 bento-card shadow-sm">
            <h2 class="font-black uppercase italic mb-6 flex items-center gap-2">
                <i class="fa-solid fa-percent text-green-600"></i> Tham số luật định
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-black uppercase opacity-50">Thuế VAT hiện tại (%)</label>
                    <input type="number" id="vat-input" class="w-full bg-gray-100 dark:bg-white/5 border-none rounded-xl p-3 mt-1 font-bold">
                </div>
                <div>
                    <label class="text-[10px] font-black uppercase opacity-50">Phí phục vụ (%)</label>
                    <input type="number" id="service-input" class="w-full bg-gray-100 dark:bg-white/5 border-none rounded-xl p-3 mt-1 font-bold">
                </div>
                <button onclick="saveConfig()" class="w-full bg-[#1e3932] text-white font-black py-3 rounded-xl mt-4 hover:bg-black transition">CẬP NHẬT CẤU HÌNH</button>
            </div>
        </div>

        <div class="col-span-12 lg:col-span-8 bento-card shadow-sm">
            <h2 class="font-black uppercase italic mb-6 flex items-center gap-2">
                <i class="fa-solid fa-shield-heart text-blue-500"></i> Sức khỏe hệ thống
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50 dark:bg-blue-900/20 p-5 rounded-2xl">
                    <p class="text-[10px] font-black text-blue-600 uppercase">Tình trạng Cache</p>
                    <h3 class="text-xl font-black mt-1" id="cache-size">0 KB</h3>
                    <button onclick="cleanSystem()" class="text-[9px] font-black uppercase mt-3 bg-blue-600 text-white px-3 py-1 rounded-lg">Dọn dẹp ngay (UC52)</button>
                </div>
                <div class="bg-green-50 dark:bg-green-900/20 p-5 rounded-2xl">
                    <p class="text-[10px] font-black text-green-600 uppercase">Phiên bản Logic</p>
                    <h3 class="text-xl font-black mt-1">v2.4.0-Final</h3>
                    <span class="status-tag bg-green-200 text-green-800 mt-2 inline-block">Mới nhất</span>
                </div>
            </div>
        </div>

        <div class="col-span-12 bento-card shadow-sm">
            <div class="flex justify-between items-center mb-6">
                <h2 class="font-black uppercase italic flex items-center gap-2">
                    <i class="fa-solid fa-bug text-red-500"></i> Error Logs (Nhật ký sửa lỗi)
                </h2>
                <button onclick="clearLogs()" class="text-xs font-bold text-red-500 hover:underline">Xóa nhật ký</button>
            </div>
            <div class="max-height-[400px] overflow-y-auto pr-4" id="log-container"></div>
        </div>
    </main>

    <script>
        let config = JSON.parse(localStorage.getItem('sb_system_config')) || { vat: 10, service: 0 };
        let errorLogs = JSON.parse(localStorage.getItem('sb_error_logs')) || [
            { time: new Date().toISOString(), message: "Memory Leak detected in POS Module", position: "staff-pos.html:142", status: "Fixed" }
        ];

        function render() {
            document.getElementById('vat-input').value = config.vat;
            document.getElementById('service-input').value = config.service;
            const logContainer = document.getElementById('log-container');
            if(errorLogs.length === 0) {
                logContainer.innerHTML = `<p class="text-center py-10 opacity-30 italic">Hệ thống đang hoạt động ổn định, không có lỗi crash.</p>`;
            } else {
                logContainer.innerHTML = errorLogs.map(log => `
                    <div class="log-entry flex justify-between items-center">
                        <div>
                            <span class="text-red-500 font-bold">[CRASH]</span> 
                            <span class="opacity-50">${new Date(log.time).toLocaleString()}</span>
                            <p class="font-bold mt-1">${log.message}</p>
                            <p class="text-[10px] opacity-40">Vị trí: ${log.position}</p>
                        </div>
                        <span class="status-tag ${log.status === 'Fixed' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}">
                            ${log.status || 'Pending'}
                        </span>
                    </div>`).join('');
            }
            const size = (JSON.stringify(localStorage).length / 1024).toFixed(2);
            document.getElementById('cache-size').innerText = size + " KB";
        }

        function saveConfig() {
            config.vat = document.getElementById('vat-input').value;
            config.service = document.getElementById('service-input').value;
            localStorage.setItem('sb_system_config', JSON.stringify(config));
            Swal.fire('Thành công (UC50)', 'Cấu hình thuế và phí đã được áp dụng.', 'success');
        }

        // UC45: Sao lưu dữ liệu (Backup)
function uc45_BackupData() {
    const data = JSON.stringify(localStorage);
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `starbucks_backup_${new Date().toLocaleDateString()}.json`;
    a.click();
    syncLogToHR("Admin thực hiện sao lưu toàn bộ dữ liệu hệ thống.");
}

// UC46: Phục hồi dữ liệu (Restore)
async function uc46_RestoreData() {
    const { value: file } = await Swal.fire({
        title: 'CHỌN FILE BACKUP (UC46)',
        input: 'file',
        inputAttributes: { 'accept': '.json' }
    });
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = JSON.parse(e.target.result);
            Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
            Swal.fire('Thành công', 'Dữ liệu đã được phục hồi. Hệ thống sẽ khởi động lại!', 'success')
            .then(() => location.reload());
        };
        reader.readAsText(file);
    }
}

        function cleanSystem() {
            localStorage.removeItem('sb_temp_files');
            Swal.fire({ title: 'Dọn dẹp thành công', text: 'Tối ưu bộ nhớ hoàn tất (UC52)', icon: 'success', timer: 1500 });
            render();
        }

        function clearLogs() { errorLogs = []; localStorage.setItem('sb_error_logs', JSON.stringify(errorLogs)); render(); }

        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('hub_theme', isDark ? 'dark' : 'light');
            updateThemeUI();
        }

        function updateThemeUI() {
            const theme = localStorage.getItem('hub_theme') || 'light';
            document.documentElement.classList.toggle('dark', theme === 'dark');
            const icon = document.getElementById('t-icon');
            if(icon) icon.className = theme === 'dark' ? 'fa-solid fa-sun text-amber-400' : 'fa-solid fa-moon text-blue-500';
        }

        function handleLogout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        window.onload = () => {
            updateThemeUI();
            render();
        };

        window.addEventListener('storage', (e) => {
            if (e.key === 'hub_theme') updateThemeUI();
        });
    </script>
</body>
</html>