<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starbucks HR | Partner Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        :root { --sb-forest: #1e3932; --sb-green: #007042; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; transition: 0.5s; background-color: #f0f2f5; color: #1e3932; }
        .dark body { background-color: #0b1613; color: #d4e9e2; }

        /* Sidebar Standard - Đồng bộ icon và hiệu ứng */
        .sidebar-floating { background: var(--sb-forest); width: 70px; height: calc(100vh - 40px); position: fixed; top: 20px; left: 20px; border-radius: 35px; z-index: 100; display: flex; flex-direction: column; align-items: center; padding: 1.5rem 0; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .nav-icon { width: 46px; height: 46px; display: flex; align-items: center; justify-content: center; border-radius: 16px; cursor: pointer; color: rgba(255, 255, 255, 0.4); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); margin-bottom: 0.8rem; position: relative; }
        .nav-icon:hover, .active-page { background: rgba(255, 255, 255, 0.15); color: #fff; transform: scale(1.15); }
        
        /* Tooltip Logic - Ẩn chữ xấu xí */
        .tooltip { position: absolute; left: 65px; background: var(--sb-forest); color: white; padding: 6px 12px; border-radius: 10px; font-size: 9px; font-weight: 800; text-transform: uppercase; white-space: nowrap; transform: scale(0); transition: 0.2s; z-index: 1000; pointer-events: none; border: 1px solid rgba(255,255,255,0.1); }
        .nav-icon:hover .tooltip { transform: scale(1); }

        .logout-btn:hover { background: #ef4444 !important; color: white !important; box-shadow: 0 10px 20px rgba(239, 68, 68, 0.4); }

        main { margin-left: 110px; padding: 40px; }
        .bento-card { background: white; border-radius: 35px; border: 1px solid rgba(0,0,0,0.03); transition: 0.4s; }
        .dark .bento-card { background: rgba(255,255,255,0.03); border-color: rgba(255,255,255,0.05); }
        
        .txt-title { font-size: 32px; font-weight: 800; font-style: italic; text-transform: uppercase; letter-spacing: -0.04em; }
        .glass-header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(15px); border-radius: 25px; padding: 20px 40px; margin-bottom: 30px; border: 1px solid rgba(0,0,0,0.05); }
        .dark .glass-header { background: rgba(11, 22, 19, 0.8); border-color: rgba(255,255,255,0.05); }
    </style>
</head>
<body class="flex">

    <aside class="sidebar-floating shadow-2xl">
        <div class="mb-8">
            <img src="https://upload.wikimedia.org/wikipedia/en/d/d3/Starbucks_Corporation_Logo_2011.svg" class="w-9 bg-white p-1 rounded-xl shadow-sm">
        </div>
        <nav class="flex-1">
            <div onclick="location.href='admin-dashboard.html'" class="nav-icon" id="nav-dash">
                <i class="fa-solid fa-chart-pie"></i>
                <span class="tooltip">Báo cáo</span>
            </div>
            <div onclick="location.href='admin-tables.html'" class="nav-icon" id="nav-tables">
                <i class="fa-solid fa-layer-group"></i>
                <span class="tooltip">Sơ đồ bàn</span>
            </div>
            <div onclick="location.href='admin-menu.html'" class="nav-icon" id="nav-menu">
                <i class="fa-solid fa-mug-hot"></i>
                <span class="tooltip">Thực đơn</span>
            </div>
            <div onclick="location.href='inventory.html'" class="nav-icon" id="nav-inv">
                <i class="fa-solid fa-boxes-stacked"></i>
                <span class="tooltip">Kho hàng</span>
            </div>
            <div onclick="location.href='hr.html'" class="nav-icon active-page" id="nav-hr">
                <i class="fa-solid fa-user-shield"></i>
                <span class="tooltip">Nhân sự</span>
            </div>
            <div onclick="location.href='admin-settings.html'" class="nav-icon" id="nav-set">
                <i class="fa-solid fa-gears"></i>
                <span class="tooltip">Cài đặt</span>
            </div>
        </nav>
        <button onclick="handleLogout()" class="nav-icon logout-btn mt-auto">
            <i class="fa-solid fa-power-off"></i>
            <span class="tooltip">Đăng xuất</span>
        </button>
    </aside>

    <main class="flex-1">
        <header class="glass-header flex justify-between items-center shadow-lg">
            <div>
                <p class="text-[10px] font-black tracking-[0.3em] text-green-600 dark:text-green-400 uppercase italic mb-1">Partner Resource Management</p>
                <h1 class="txt-title text-[#1e3932] dark:text-white">Hồ Sơ Nhân Sự</h1>
            </div>
            <button onclick="uc32_AddStaff()" class="bg-[#1e3932] dark:bg-[#007042] text-white px-8 py-4 rounded-2xl font-black text-[11px] uppercase shadow-xl hover:scale-105 transition-all">
                + Chiêu mộ Partner
            </button>
        </header>

        <div class="bento-card p-10 shadow-sm overflow-hidden">
            <table class="w-full text-left">
                <thead>
                    <tr class="text-gray-400 uppercase text-[10px] font-black tracking-widest border-b border-gray-100 dark:border-white/10">
                        <th class="pb-8">Thông tin Partner</th>
                        <th class="pb-8">Vai trò (UC36)</th>
                        <th class="pb-8 text-center">Trạng thái</th>
                        <th class="pb-8 text-right">Quản trị (UC34/39)</th>
                    </tr>
                </thead>
                <tbody id="staff-list-ui"></tbody>
            </table>
        </div>
    </main>

<script>
    let staffList = JSON.parse(localStorage.getItem('sb_hr')) || [];

    if (staffList.length === 0) {
        staffList = [{ id: 999, name: "Manager Admin", username: "admin", password: "123", role: "Admin", status: "Active" }];
        localStorage.setItem('sb_hr', JSON.stringify(staffList));
    }

    function render() {
        const tbody = document.getElementById('staff-list-ui');
        tbody.innerHTML = staffList.map(s => `
            <tr class="border-b border-gray-50 dark:border-white/5 hover:bg-gray-50 dark:hover:bg-white/5 transition-all group">
                <td class="py-8">
                    <p class="text-xl font-black uppercase italic leading-none mb-1 text-[#1e3932] dark:text-white group-hover:text-[#007042] transition">${s.name}</p>
                    <div class="flex gap-2 mt-2">
                        <span class="text-[9px] font-bold uppercase text-gray-400">User: ${s.username}</span>
                        <span class="text-[9px] font-bold uppercase text-amber-600">Pass: ${s.password}</span>
                    </div>
                </td>
                <td>
                    <span class="px-4 py-1.5 rounded-full text-[9px] font-black uppercase ${s.role === 'Admin' ? 'bg-amber-100 text-amber-700' : 'bg-green-100 text-green-700'}">
                        ● ${s.role || 'Staff'}
                    </span>
                </td>
                <td class="text-center">
                    <span class="text-[11px] font-black uppercase ${s.status === 'Active' ? 'text-green-500' : 'text-red-500'}">
                        ${s.status}
                    </span>
                </td>
                <td class="text-right">
                    ${s.username !== 'admin' ? `
                        <button onclick="uc39_ToggleLock(${s.id})" class="p-3 bg-gray-100 dark:bg-white/10 rounded-xl text-gray-500 hover:bg-[#1e3932] hover:text-white transition-all mr-2">
                            <i class="fa-solid ${s.status === 'Active' ? 'fa-user-lock' : 'fa-user-check'} text-xs"></i>
                        </button>
                        <button onclick="uc34_DeleteStaff(${s.id})" class="p-3 bg-red-50 dark:bg-red-900/20 text-red-500 hover:bg-red-500 hover:text-white transition-all">
                            <i class="fa-solid fa-trash-can text-xs"></i>
                        </button>
                    ` : '<span class="text-[10px] font-black text-gray-300 italic uppercase">Master Account</span>'}
                </td>
            </tr>
        `).join('');
        localStorage.setItem('sb_hr', JSON.stringify(staffList));
    }

    async function uc32_AddStaff() {
        const { value: f } = await Swal.fire({
            title: '<span class="text-xl font-black uppercase italic tracking-tighter">Đăng ký Partner mới</span>',
            html: `
                <div class="text-left space-y-4 p-4">
                    <div><label class="text-[10px] font-black uppercase text-gray-400 ml-1">Họ tên Partner</label>
                    <input id="sw-n" class="swal2-input !m-0 !w-full !rounded-xl !text-sm" placeholder="Nhập tên..."></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="text-[10px] font-black uppercase text-gray-400 ml-1">Username</label>
                        <input id="sw-u" class="swal2-input !m-0 !w-full !rounded-xl !text-sm" placeholder="Username..."></div>
                        <div><label class="text-[10px] font-black uppercase text-gray-400 ml-1">Mật mã</label>
                        <input id="sw-p" class="swal2-input !m-0 !w-full !rounded-xl !text-sm" value="123"></div>
                    </div>
                    <div><label class="text-[10px] font-black uppercase text-gray-400 ml-1">Phân quyền</label>
                    <select id="sw-r" class="swal2-input !m-0 !w-full !rounded-xl !text-sm">
                        <option value="Staff">Partner (Staff)</option>
                        <option value="Admin">Executive (Admin)</option>
                    </select></div>
                </div>
            `,
            confirmButtonText: 'HOÀN TẤT ĐĂNG KÝ',
            confirmButtonColor: '#1e3932',
            showCancelButton: true,
            preConfirm: () => {
                const name = document.getElementById('sw-n').value;
                const user = document.getElementById('sw-u').value;
                const pass = document.getElementById('sw-p').value;
                if (!name || !user || !pass) return Swal.showValidationMessage('Vui lòng điền đầy đủ!');
                return { name, username: user, password: pass, role: document.getElementById('sw-r').value }
            }
        });
        if (f) {
            staffList.push({ id: Date.now(), ...f, status: 'Active' });
            render();
            Swal.fire({ title: 'Thành công', text: 'Partner đã được thêm vào hệ thống.', icon: 'success', confirmButtonColor: '#1e3932' });
        }
    }

    function uc39_ToggleLock(id) {
        const user = staffList.find(x => x.id === id);
        user.status = user.status === 'Active' ? 'Locked' : 'Active';
        render();
        const toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 2000 });
        toast.fire({ icon: 'success', title: `Đã ${user.status === 'Active' ? 'mở khóa' : 'tạm khóa'} tài khoản` });
    }

    function handleLogout() {
        localStorage.removeItem('currentUser');
        window.location.href = 'index.html';
    }

    function updateTheme() {
        const theme = localStorage.getItem('hub_theme') || 'light';
        if (theme === 'dark') document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
    }

    // Cập nhật UC34: Kiểm tra trạng thái trước khi xóa
function uc34_DeleteStaff(id) {
    const user = staffList.find(x => x.id === id);
    if (user.status === 'Active') {
        return Swal.fire('LỖI (AC34)', 'Không thể xóa nhân viên đang ở trạng thái Active. Hãy khóa tài khoản trước!', 'error');
    }

    Swal.fire({
        title: 'Xác nhận xóa?',
        icon: 'warning',
        showCancelButton: true
    }).then(res => {
        if(res.isConfirmed) {
            staffList = staffList.filter(x => x.id !== id);
            // GHI LOG (UC34 Task)
            syncLogToHR(`Admin đã xóa hồ sơ nhân sự: ${user.name}`);
            render();
        }
    });
}

// Hàm ghi log tập trung
function syncLogToHR(msg) {
    let logs = JSON.parse(localStorage.getItem('sb_logs')) || [];
    logs.push({ time: new Date().toLocaleTimeString(), partner: "Executive Admin", action: msg });
    localStorage.setItem('sb_logs', JSON.stringify(logs));
}

    window.onload = () => {
        updateTheme();
        render();
    };
    
    window.addEventListener('storage', (e) => {
        if (e.key === 'hub_theme') updateTheme();
    });
</script>
</body>
</html>